---
title: "Statistik och dataanalys I, 15 hp "
subtitle: "Inl칛mningsuppgift 1"
author: 
- Namn 1
- Namn 2
- Namn 3
date: last-modified
format: 
  html:
    self-contained: true
  pdf: default  
  docx: default
toc: true
language: 
  title-block-author-single: " "
toc-title-document: "Inneh친ll"
crossref-fig-title: "Figur"
theme: lumen
title-block-banner-color: Primary
title-block-published: "Publicerad"
callout-warning-caption: "Varning"
callout-note-caption: "Observera"
callout-tip-caption: "Tips"
editor: visual
---

::: callout-warning
Den h칛r inl칛mningsuppgiften f칬ruts칛tter att f칬ljande paket finns installerade:

-   `mosaic`

-   `dplyr`

-   `geosphere`

-   `leaflet`

Paket kan installeras via kommandot `install.packages('packagename')`, d칛r `'packagename'` 칛r namnet p친 paketet, t.ex `'mosaic'`.
:::

## Introduktion

I den f칬rsta inl칛mningsuppgiften ska ni sj칛lvst칛ndigt i grupper om tre analysera ett dataset i programmeringsspr친ket R. Till skillnad fr친n datorlaborationerna finns det minimalt med kodexempel. Datorlaborationerna g친r igenom de flesta momenten som behandlas i inl칛mningsuppgiften, s친 se till att g칬ra klart dessa innan.

------------------------------------------------------------------------

::: callout-note
### Instruktioner

I denna inl칛mningsuppgift ska ni analysera ett datamaterial som beskriver ca 500 distrikt i Boston 친r 1970. Datasetet 칛r en modifierad version[^1] av originaldata[^2] som anv칛ndes i en studie[^3] d칛r f칬rfattarna predikterade medianhuspriser i olika distrikt med hj칛lp av en rad f칬rklaringsvariabler.

F칬ljande variabler finns i datasetet `boston_census_data.Rdata` ([ladda ner](https://github.com/StatisticsSU/SDA1/blob/main/assignments/assignment1/Boston_census_data.RData?raw=true)), som inneh친ller 480 observationer. Notera att en observation motsvarar ett distrikt:

-   `town`: Stadsdel.
-   `longitude`: Longitud koordinat.
-   `latitude`: Latitud koordinat.
-   `median_home_value`: Medianhuspriset (enhet 1K USD).
-   `crime_rate`: Brott (per 1000 inv친nare).
-   `zoned_25k_p`: Andel av stadsdelens bostadsmark 칛mnad f칬r marklotter st칬rre 칛n 25000 kvadratfot.
-   `indust_p`: Andel tunnland 칛gd av f칬retag utanf칬r detaljhandel.
-   `borders_charles`: Charles River dummy variabel (= 1 om omr친det gr칛nsar till floden, 0 annars).
-   `NOx`: Koncentration av kv칛veoxider (andelar per 10 miljon).
-   `n_rooms_avg`: Genomsnitt antal rum i 칛gda bost칛der.
-   `before_1940_p`: Andel 칛gda bost칛der byggda f칬re 1940.
-   `employ_dist`: Viktat avst친nd till fem arbetsf칬rmedlingscentra i Boston.
-   `radial_access`: Index som m칛ter tillg친ng till stadsmotorv칛gar.
-   `tax_rate`: Fastighetsskatt per 10000 USD.
-   `pupil_teacher_ratio`: L칛rart칛thet m칛tt som elev per l칛rare.
-   `lower_stat_pct`: Procentandel med l친g socioekonomisk status i termer av utbildning eller arbete.
-   `dist_fenway_park`: Avst친nd till stadion Fenway Park.

Inl칛mningsuppgiften ska l칛mnas in i form av ett html-dokument genererat av Quarto. **Kontrollera att ni inte f친r n친gra felmeddelande n칛r du genererar HTML-dokumentet. L칛s sedan igenom HTML-dokumentet noggrant innan ni l칛mnar in det.** Anv칛nd tydliga figurer och namnge axlarna med tydliga variabelnamn. Gl칬m inte att skriva era namn i b칬rjan av dokumentet, d칛r det nu st친r Namn 1, Namn 2 och Namn 3.
:::

[^1]: Totalunders칬kningen trunkerade medianhusv칛rdet till 50K f칬r de censusdistrikten som l친g 칬ver. Vi har tagit bort dessa censusdistrikt. Vi har ocks친 tagit bort variabler som 칛r irrelevanta.

[^2]: Harrison Jr, D., & Rubinfeld, D. L. (1978). Hedonic housing prices and the demand for clean air. Journal of Environmental Economics and Management, 5(1), 81-102.

[^3]: Pace, R. K., & Gilley, O. W. (1997). Using the spatial configuration of the data to improve estimation. The Journal of Real Estate Finance and Economics, 14(3), 333-340.

## 0. Ladda in data

### 游눩 Uppgift 0.1

Ladda in datasetet `Boston_census_data` med f칬ljande kod.

#### Uppgift 0.1 - Svar

```{r}
# Write your code here
load(file = url("https://github.com/StatisticsSU/SDA1/blob/main/assignments/assignment1/Boston_census_data.RData?raw=true")) 
```

## 1. Kriminalitet i Boston

I detta avsnitt ska ni analysera kriminaliteten i Boston med hj칛lp av variabeln `crime_rate`.

### 游눩 Uppgift 1.1

Vad kan man generellt s칛ga om kriminaliteten i Boston 1970? Anv칛nd l칛mpliga figurer och m친tt f칬r att ge en beskrivning.

#### Uppgift 1.1 - Svar

Skriv svaret h칛r. Vid behov skrivs matematiska symboler inom dollartecken, till exempel $\overline{y} = \cfrac{\sum^{n}_{i=1} y_i}{n}$. Koden skrivs i den gr친 R-rutan nedanf칬r.

```{r}
# Write your code here
```

### 游눩 Uppgift 1.2

Distrikten tillh칬r olika stadsdelar som anges i den kategoriska variabeln `town`? Det finns 88 olika s친dana stadsdelar (towns).

*Skiljer sig brottsligheten 친t mellan de olika stadsdelarna?* Unders칬k stadsdelarna `Boston East Boston`, `Boston Downtown`, `Cambridge`, samt ytterligare en stadsdel som ni sj칛lva v칛ljer. Besvara fr친gan med hj칛lp av l칛mpligt valda figurer och statistiska m친tt.

::: callout-tip
Innan ni p친b칬rjar analysen, skapa en ny data frame som enbart inneh친ller de stadsdelar som ni vill j칛mf칬ra. Det kan g칬ras till exempel med funktionen `filter()`.
:::

#### Uppgift 1.2 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

### 游눩 Uppgift 1.3

Vilka tv친 variabler i datasetet `Boston_census_data` korrelerar mest med brottslighet? Beskriv sambandet mellan brottslighet och var och en av dessa tv친 variabler.

::: callout-tip
Kom ih친g att korrelation m칛ter det linj칛ra sambandet mellan *numeriska variabler*.
:::

#### Uppgift 1.3 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

## 2. Fastighetsskatt i Boston

I detta avsnitt ska ni analysera fastighetsskatten i Boston med hj칛lp av variabeln `tax_rate`.

### 游눩 Uppgift 2.1

Vad kan man generellt s칛ga om fastighetsskatten i distrikten? Anv칛nd l칛mpliga figurer och m친tt f칬r att beskriva f칬rdelningen.

#### Uppgift 2.1 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

#### 游눩 Uppgift 2.2

L친t oss skapa en ny variabel `cat_tax` som anger om ett distrikt betalar l친g (`low`), medel (`medium`), eller h칬g (`high`) fastighetsskatt. Vi definerar skattekategorierna enligt

-   `low`: `tax_rate` $\leq$ 250,
-   `medium`: 250 $<$ `tax_rate` $\leq$ 400,
-   `high`: `tax_rate` $>$ 400.

F칬ljande kod skapar och l칛gger till variabeln `cat_tax` i `Boston_census_data`

```{r}
Boston_census_data$cat_tax <- cut(Boston_census_data$tax_rate, 
              breaks=c(0, 250, 400, 800),
              labels=c('Low', 'Medium', 'High'))
```

Finns det ett samband mellan vilken skattekategori ett distrikt tillh칬r och dess angr칛nsning till Charles River? F칬rklara med hj칛lp av l칛mplig tabell och figur.

#### Uppgift 2.2 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

### 游눩 Uppgift 2.3

Hur m친nga procent av alla distrikt i v친r data ligger i angr칛nsning till Charles River *och* tillh칬r en h칬g skattekategori? Hur stor andel av distrikten med h칬g skatt ligger *inte* i angr칛nsning till Charles River?

#### Uppgift 2.3 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

### 游눩 Uppgift 2.4

Vilka tv친 variabler i datasetet `Boston_census_data` korrelerar starkast med `tax_rate`? Beskriv det parvisa sambandet mellan `tax_rate` och var och en av dessa tv친 variabler. Vad kan vi s칛ga om kausalitet f칬r vart och ett av sambanden?

::: callout-tip
Kom ih친g att korrelation 칛r ett m친tt p친 linj칛ra samband mellan *numeriska variabler*.
:::

#### Uppgift 2.4 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

## 3. Avst친nd till Fenway park

I detta avsnitt ska ni unders칬ka variabeln `dist_fenway_park`, som m칛ter avst친ndet mellan ett distrikt och Fenway park (stadion d칛r basebollslaget Boston Red Sox spelar sina hemmamatcher).

Vi kan visualisera Fenway park och distrikten p친 en karta med hj칛lp av R-paketet `leaflet`. F칬ljande kod visar platsen f칬r Fenway park och distrikten f칬r observationerna 30 och 45.

```{r}
library(leaflet) # Install if not available
fenway_park_lat_long <- c(42.346462, -71.097250) # latitude and longitude for Fenway_park
Boston_map <- leaflet() %>% 
  addTiles() %>%
  addMarkers(lat = fenway_park_lat_long[1], lng = fenway_park_lat_long[2], popup="Fenway park") %>%
  addMarkers(lat = Boston_census_data$latitude[30], lng = Boston_census_data$longitude[30], popup="Observation 30") %>%
  addMarkers(lat = Boston_census_data$latitude[45], lng = Boston_census_data$longitude[45], popup="Observation 45") 

Boston_map # Show interactive map
```

### 游눩 Uppgift 3.1

Vilket distrikt i v친r data har l칛ngst respektive kortast avst친nd till Fenway park? Markera ut dessa distrikt i en interaktiv karta tillsammans med Fenway park.

#### Uppgift 3.1 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

### 游눩 Uppgift 3.2

Finns det ett samband mellan `dist_fenway_park` och `crime_rate`?

#### Uppgift 3.2 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

## 4. Enkel linj칛r regression

I detta avsnitt ska ni anpassa och tolka enkla linj칛ra regressionsmodeller.

### 游눩 Uppgift 4.1

Anpassa en linj칛r regression med responsvariabeln `NOx` och den f칬rklarande variabeln `employ_dist`. Rita den anpassade regressionslinjen tillsammans med data i en l칛mplig figur. Beskriv resultaten och tolka modellen. Utf칬r en modellvalidering via en residualanalys och kommentera modellens l칛mplighet. Om modellen inte anses l칛mplig, vilka antaganden har inte varit uppfyllda?

#### Uppgift 4.1 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

### 游눩 Uppgift 4.2

Anv칛nd modellen i Uppgift 4.1 f칬r att prediktera koncentration av kv칛veoxider f칬r observation 10, d칛r `employ_dist`=10.5857. Ber칛kna vad residualen blir f칬r denna observation.

#### Uppgift 4.2 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

### 游눩 Uppgift 4.3

Transformera variablerna i Uppgift 4.1 (avg칬r sj칛lv vilken eller vilka av de tv친 som beh칬ver transformeras). Ett f칬rslag 칛r att anv칛nda Tukeys cirkel f칬r att hitta l칛mpliga transformationer. Anpassa en ny linj칛r regression med de transformerade variablerna. Utf칬r en modellvalidering (efter transformation) via en residualanalys och kommentera modellens l칛mplighet j칛mf칬rt med modellen i Uppgift 4.1.

#### Uppgift 4.3 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

### 游눩 Uppgift 4.4

Plotta den anpassade regressionen fr친n 4.3 i icke-transformerad skala tillsammans med observationerna (ocks친 i icke-transformerad skala) i en l칛mplig figur.

#### Uppgift 4.4 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

### 游눩 Uppgift 4.5

Anv칛nd modellen i Uppgift 4.3 f칬r att prediktera koncentration av kv칛veoxider i icke-transformerad skala f칬r observation 10, d칛r `employ_dist`=10.5857. Ber칛kna vad residualen blir f칬r denna observation. Kommentera resultaten j칛mf칬rt med Uppgift 4.2.

::: callout-tip
T칛nk p친 att ta h칛nsyn till eventuella transformationer!
:::

#### Uppgift 4.5 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

## 5. Multipel linj칛r regression

I detta avsnitt ska ni studera multipel linj칛ra regression.

### 游눩 Uppgift 5.1

Anpassa en linj칛r regression med responsvariabel logaritmerad `median_home_value` samt f칬rklarande variabler `lower_stat_pct` och dummy-variabeln `borders_charles`. Tolka koefficienten f칬r `borders_charles`.

#### Uppgift 5.1 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

### 游눩 Uppgift 5.2

Ni ska nu utforma en modell som predikterar medianhuspriset `median_home_value`. Ni f친r endast anv칛nda f칬ljande f칬rklaringsvariabler:

-   `before_1940_p`
-   `crime_rate`
-   `radial_access`
-   `NOx`
-   `dist_fenway_park`

Ni f친r sj칛lva v칛lja hur m친nga av variablerna som ska ing친 i modellen. Ni f친r g칬ra vilka transformationer ni vill av variablerna, inklusive responsvariabeln.

Pr칬va er fram metodiskt n칛r ni v칛ljer vilka variabler ni inkluderar i modellen, och n칛r ni best칛mmer vilka eventuella transformationer ni anv칛nder.

N칛r ni utv칛rderar olika modeller kan ni f칬rslagsvis b칬rja med att j칛mf칬ra adjusted R-squared. N칛r ni med hj칛lp av adjusted R-squared har identifierat tv친 eller tre modeller som ser lovande ut kan ni utv칛rdera dessa modeller ytterligare i ett andra steg.

I det andra steget ska ni utv칛rdera hur v칛l modellerna predikterar data som *inte* anv칛nts f칬r att anpassa modellen. Ni kan v칛lja *en av tv친 alternativa metoder*:

1.  Dela in ert dataset i tr칛ningsdata och testdata. Anpassa modellen med hj칛lp av tr칛ningsdata, och utv칛rdera sedan p친 testdata. Ni kan exempelvis anv칛nda de f칬rsta 350 observationerna som tr칛ningsdata och de sista 130 observationerna som testdata.
2.  Anv칛nd korsvalidering. Det 칛r en n친got mer kr칛vande metod, men ocks친 n친got b칛ttre. Ni kan exempelvis g칬ra korsvalidering med 4 folds (4-fold cross validation). Dela d친 upp ert dataset i fyra delar (del 1: observationer 1-120, del 2: observationer 121-240, del 3: observationer 241-360, del 4: observationer 361-480).

*Sortera inte observationerna i `Boston_census_data` slumpm칛ssigt. Ordningen 칛r redan slumpm칛ssig.*

::: callout-tip
T칛nk p친 att ta h칛nsyn till eventuell transformation av responsvariabeln. Om ni exempelvis har valt transformationen $\log(y)$ 칛r modellens prediktion av responsvariabeln $\widehat{\log(y)}$. Ni m친ste d친 transformera den till $\hat y$ i responsvariabelns originalskala med formeln $\hat{y}=\exp\left(\widehat{\log(y)}\right)$. Sedan kan ni r칛kna ut residualen $y - \hat y$.
:::

#### Uppgift 5.2 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

### 游눩 Uppgift 5.3

G칬r en residualanalys av den valda modellen i Uppgift 5.2.

#### Uppgift 5.3 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```

### 游눩 Uppgift 5.4

Anv칛nd modellen i Uppgift 5.2 f칬r att prediktera medianhuspriset f칬r observationerna i datasetet `Boston_districts_to_predict` ([ladda ner](https://github.com/StatisticsSU/SDA1/blob/main/assignments/assignment1/Boston_districts_to_predict.RData?raw=true)).

#### Uppgift 5.4 - Ladda hem data f칬r prediktion

Ladda in dataseten `Boston_districts_to_predict` med f칬ljande kod.

```{r}
# Write your code here
load(file = url("https://github.com/StatisticsSU/SDA1/blob/main/assignments/assignment1/Boston_districts_to_predict.RData?raw=true")) 
```

Det h칛r datasetet har endast de f칬rklarande variablerna, dvs inte responsvariabeln. N칛r vi r칛ttar era inl칛mningsuppgifter kommer vi att j칛mf칬ra era prediktioner med de faktiska medianpriserna (som vi har tillg친ng till).

Skriv ut dina prediktioner s친 att vi enkelt kan se dem n칛r vi r칛ttar.

::: callout-tip
T칛nk p친 att ta h칛nsyn till eventuella transformationer av f칬rklaringsvariablerna!
:::

#### Uppgift 5.4 - Svar

Skriv textsvaret h칛r.

```{r}
# Write your code here
```
